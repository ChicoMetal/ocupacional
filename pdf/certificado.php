<?php//============================================================+// File name   : example_003.php// Begin       : 2008-03-04// Last Update : 2010-08-08//// Description : Example 003 for TCPDF class//               Custom Header and Footer//// Author: Nicola Asuni//// (c) Copyright://               Nicola Asuni//               Tecnick.com LTD//               Manor Coach House, Church Hill//               Aldershot, Hants, GU12 4RQ//               UK//               www.tecnick.com//               info@tecnick.com//============================================================+/** * Creates an example PDF TEST document using TCPDF * @package com.tecnick.tcpdf * @abstract TCPDF - Example: Custom Header and Footer * @author Nicola Asuni * @since 2008-03-04 */require_once('tcpdf/config/lang/eng.php');require_once('tcpdf/tcpdf.php');require 'clases/Db.class.php';require 'clases/Conf.class.php';require 'clases/Conv.class.php';$bd=Db::getInstance();$conv=Conv::getInstance();$codigofact=$_GET['codigo'];// Extend the TCPDF class to create custom Header and Footerclass MYPDF extends TCPDF {	public  $filaactual=0;	public $compasig="",$compacate="";	private  $codigofact="",$entroli=0;		 function certificadointegral($datos,$datosaptitud,$datosdbrecomendaciones, $codigofact)	{	$style6 = array('width' => 0.1, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0, 'color' => array(0, 0, 0)); 		$tam1=5;	 $li=30;     $this->cabecera($datos,4, $codigofact);     $this->SetFont('helvetica', '', 10);     $this->SetFillColor(255, 255, 255); 	 $li=$li+8;     $this->MultiCell(200, 5,"TIPO ".strtoupper($datos[0]['tipo'])."\n", 0, 'J', 1, 0, 5, $li, true);	 $li=$li+$tam1;	 	 //$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);	 $this->Line(5, $li, 205, $li);	 $this->MultiCell(200, 5,"Lugar y Fecha:  Sincelejo - Sucre              ".strtoupper($datos[0]['fecha'])."\n", 0, 'J', 1, 0, 5, $li, true);	 $li=$li+$tam1;	 //$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '1111',null,$style6);	 $this->MultiCell(200, 5,"Empresa: ".strtoupper($datos[0]['razonsocial'])."                                     En mision: ".strtoupper($datos[0]['enmision'])."\n", 0, 'J', 1, 0, 5, $li, true);	  $this->SetFont('helvetica', 'B', 10);	 $li=$li+$tam1;	 //$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);	 $this->MultiCell(200, 5,"DATOS TRABAJADOR / ASPIRANTE\n", 0, 'J', 1, 0, 5, $li, true);	 	 $this->SetFont('helvetica', '', 10);	 $li=$li+$tam1;	 //$this->Line(5, $li, 205, $li);	 // $this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);	 $this->MultiCell(200, 5,"Nombres: ".strtoupper($datos[0]['nombres'])."                                     Apellidos:: ".strtoupper($datos[0]['apellidos'])."\n", 0, 'J', 1, 0, 5, $li, true);	 $li=$li+$tam1;	 // $this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);	 $this->MultiCell(200, 5,"Edad: ".strtoupper($datos[0]['edad'])." años  C.C: ".strtoupper($datos[0]['identificacion'])."  Cargo actual/aspira: ".strtoupper($datos[0]['cargo_atual'])."\n", 0, 'J', 1, 0, 5, $li, true);	  $this->SetFont('helvetica', 'B', 10);	 	 $li=$li+$tam1+3;	 //$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);		 	$this->Line(5, $li, 205, $li);	 $this->MultiCell(200, 5,"EXAMENES REALIZADOS\n", 0, 'L', 1, 0, 5, $li, true);	 	 $li=$li+$tam1;	  //$this->Line(5, $li, 205, $li);	 $this->SetFont('helvetica', '', 10);		if($datos!="")//si no esta vacio			foreach ($datos as  $datos1) {				//$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);				$this->MultiCell(200, 5,"".ucfirst(strtolower($datos1['examen']))."\n", 0, 'J', 1, 0, 5, $li, true);				    $li=$li+$tam1;						}   $this->SetFont('helvetica', 'B', 10);	 $li=$li+$tam1;	 $this->MultiCell(200, 5,"CONCEPTO DE APTITUD MEDICA OCUPACIONAL\n", 0, 'L', 1, 0, 5, $li, true);	 $li=$li+$tam1;	 //$this->Line(5, $li, 205, $li);	 $this->SetFont('helvetica', '', 10);		if($datosaptitud!="")//si no esta vacio			foreach ($datosaptitud as  $datosac) {				//$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);				$this->MultiCell(200, 5,"".ucfirst(strtolower($datosac['nombreconcepto']))."\n", 0, 'J', 1, 0, 5, $li, true);				    $li=$li+$tam1;									} 	 $this->buscarrecomendaciones($datos,$datosdbrecomendaciones,$li);	 }	function buscarrecomendaciones($datos,$datosdbrecomendaciones,$inicio){$style6 = array('width' => 0.1, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0, 'color' => array(0, 0, 0));		$tam1=4;       $li=$inicio;	  	   $this->SetFont('helvetica', 'B', 10);	 $li=$li+$tam1;	 $this->MultiCell(200, 5,"RECOMENDACIONES LABORALES\n", 0, 'L', 1, 0, 5, $li, true);	 $li=$li+$tam1+3;	 //$this->Line(5, $li, 205, $li);	 $this->SetFont('helvetica', '', 10);	 $i=0;	 	 $tamori= $li;	 $aux=$li;	 $enx=5;	 $entro=0;	 $cambiodelinea=0;	 $mayoraux=0;	 for ($i=1;$i<=8;$i++)	 {	 		if($datosdbrecomendaciones!="")			foreach ($datosdbrecomendaciones as  $datosac) 			{															    	if($datosac['codigo']==$i)					{						if($entro==0)						{						$entro=1;						 $this->SetFont('helvetica', 'B', 10);						$this->MultiCell(50, 5,"".$datosac['rgeneral']."\n", 0, 'J', 1, 0, $enx, $aux, true);							 $aux=$aux+$tam1+2;						 $cambiodelinea=$cambiodelinea+1;						  						}						$this->SetFont('helvetica', '', 7);					  $this->MultiCell(50, 5,"".ucfirst(strtolower ($datosac['recomendacion'])).".\n", 0, 'L', 1, 0, $enx, $aux, true);						  if(strlen($datosac['recomendacion'])>=43)					  {					   $aux=$aux+$tam1;					  }					  $aux=$aux+$tam1;					}					else					{						if($entro==1)						{																			if($aux>$mayoraux)							{							  $mayoraux=$aux;							}													$aux=$li;						$enx=$enx+50;						$entro=0;						}								}																}			if( $cambiodelinea==4)					{					$tam=  $mayoraux- $li;					//$this->RoundedRect(4, $li, 200,$tam , 3.50, '0000',null,$style6);				   // $this->Line(51, $li, 51,$mayoraux);					////$this->Line(101, $li, 101,$mayoraux);					//$this->Line(151, $li, 151,$mayoraux);						$aux=$mayoraux;						$li=$mayoraux;						$enx=5;						$entro=0;					}	 }				if( $cambiodelinea!=0)     {					$tam=  $mayoraux- $li;					//$this->RoundedRect(4, $li, 200,$tam , 3.50, '0000',null,$style6);					// $this->Line(51, $li, 51,$mayoraux);					//$this->Line(101, $li, 101,$mayoraux);					//$this->Line(151, $li, 151,$mayoraux);					$li=$mayoraux+4;					      	  		}				$this->SetFont('helvetica', '', 7);			//$this->MultiCell(200, 5,"<b>Consentimiento informado:</b> Autorizo al profesional abajo mencionado a que se me realice de manera voluntaria el examen medico ocupacional, examenes complementarios y dejo constancia que tuve la oportunidad de manifestar mi consentimiento para la realizacion del examen medico ocupacional y/o examenes complementarios, a partir de la informacion recibida por el profsional abajo mencionado. Certifico que la informacion que he suministrado es verdadera, completa, que no omiti ningun dato relevante, que los datos consignado fueron los aportados por mi al momento del examen y acepto el manejo de condicionalidad que SOIE IPS Ltda. De a la misma. Autorizo que suministro la informacion necesaria a la empresa contrante o entidades contempladas en la legislacion para el cumplimiento del programa de salud ocupacional, me entregaron copia de los examenes realizados.".".\n", 0, 'J', 1, 0, 5, $li, true,0,true);		$li=$li+40;		 $this->SetFont('helvetica', '', 10);	 	 $this->Line( 5,$li ,80,$li);	$this->MultiCell(80, 5,"<B>Edison Martinez Diaz / R.M. 428 </B> <br> C.C 92504399<br>LICENCIA S.O No. 925".".\n", 0, 'C', 1, 0, 5, $li, true,0,true);			 $this->Line( 110,$li ,185,$li);	$this->MultiCell(80, 5,"<B>Firma trabajador </B>"."\n", 0, 'C', 1, 0, 110, $li, true,0,true);			 $image_file = "../fotos/firmas/".$datos[0]['firma'];                      $this->Image($image_file,120, $li-16, 50, 15, 'JPG', '', 'T', false, 100, '', false, false, 0, false, false, false);				 $image_file = "firmadigital.jpg";                      $this->Image($image_file,15, $li-26, 80, 25, 'JPG', '', 'T', false, 100, '', false, false, 0, false, false, false);					}	function otrosexamenesimp($datacuestionario,$inicio){	$style6 = array('width' => 0.1, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0, 'color' => array(0, 0, 0));	$tam1=4;	$li=$inicio;	// $this->SetFont('helvetica', 'B', 10);	//$li=$li+$tam1;	//$this->MultiCell(200, 5,"RECOMENDACIONES LABORALES\n", 0, 'C', 1, 0, 5, $li, true);	$li=$li+$tam1+3;	$this->SetFont('helvetica', '', 10);	$i=0;	$tamori= $li;	$aux=$li;	$enx=5;	$entro=0;	$cambiodelinea=0;	$mayoraux=0;	$codpadre="";	$linea=0;	$span=10;		$nombreexamen="";	if($datacuestionario!="")//si no esta vacio	foreach ($datacuestionario as  $data){		if($nombreexamen!=$data['nomactividad']){			$this->SetFont('helvetica', 'B',10);			$aux=$this->addli($aux,$tam1);			 $this->Line(5, $aux, 205, $aux);			$this->MultiCell(90, 10,$data['nomactividad'], 0, 'L', 1, 0, $span, $aux, true);	 			$aux=$this->addli($aux,$tam1); 			 $this->Line(5, $aux, 205, $aux); 			$aux=$this->addli($aux,$tam1);		}				$nombreexamen=$data['nomactividad'];		if($codpadre!=$data['codpadre']){			/*if($linea==0){				$linea=1;				$span=5;				$li=$this->addli($aux,$tam1);			}else{				$span=100;				$linea=0;				$aux=$li;			}*/			$this->SetFont('helvetica', 'B',6);			$this->MultiCell(200, 5,$data['nompadre'], 0, 'L', 1, 0, $span, $aux, true);							$aux=$this->addli($aux,$tam1);			if(strlen($data['nompadre'])>=35){				   $aux=$this->addli($aux,$tam1);			}		}		$this->SetFont('helvetica', '', 6);		$codpadre=$data['codpadre'];		$codpregunta="";		if($data["tipo"]=="text"){			$this->MultiCell(200, 5,"".$data['pregunta']."\n", 0, 'L', 1, 0, $span, $aux, true);								//echo "</td></tr><tr><td colspan='2'>".$data['pregunta']."</td></tr><tr><td>";			$campoval=array_filter(explode('<div class="respuestas" >',$data['campos']));			$campovalres=array_filter(explode('<div class="respuestas" >',$data['respuestas']));			$aux=$this->addli($aux,$tam1);			$cont=1;			$acumuladorcampos="";			$tamacu=0;			foreach ($campoval as $campo) {				$campo=str_replace("</div>", "", $campo);				$campovalres[$cont]=str_replace("</div>", "", $campovalres[$cont]);				$acumuladorcampos.=" ".$campo.": ".$campovalres[$cont];								$tamacu+=strlen($campo.": ".$campovalres[$cont]);				$cont++;			}			$this->MultiCell(200, 10,$acumuladorcampos, 0, 'L', 1, 0, $span, $aux, true);							if(strlen($acumuladorcampos)>=30){				   $aux=$this->addli($aux,$tam1);				   //$this->MultiCell(90, 10,$aux, 0, 'J', 1, 0, $span, $aux, true);				}			if(strlen($acumuladorcampos)>=60){				   $aux=$this->addli($aux,$tam1);				   //$this->MultiCell(90, 10,$aux, 0, 'J', 1, 0, $span, $aux, true);				}				if(strlen($acumuladorcampos)>=90){				   $aux=$this->addli($aux,$tam1);				   //$this->MultiCell(90, 10,$aux, 0, 'J', 1, 0, $span, $aux, true);				}						}else if($data["tipo"]=="radio"){			$cont=1;			$campovalres=array_filter(explode('<div class="respuestas" >',$data['respuestas']));			$campovalres[$cont]=str_replace("</div>", "", $campovalres[$cont]);			$campovalres[$cont]=str_replace("</div>", "", $campovalres[$cont]);			$this->MultiCell(200, 5,$data['pregunta'].": ".$campovalres[$cont], 0, 'L', 1, 0, $span, $aux, true);				$cont++;			$aux=$this->addli($aux,$tam1);		}else if($data["tipo"]=="select"){			$cont=1;			$campovalres=array_filter(explode('<div class="respuestas" >',$data['respuestas']));			$campovalres[$cont]=str_replace("</div>", "", $campovalres[$cont]);			$campovalres[$cont]=str_replace("</div>", "", $campovalres[$cont]);			$this->MultiCell(90, 5,$data['pregunta'].": ".$campovalres[$cont], 0, 'L', 1, 0, $span, $aux, true);				$cont++;			$aux=$this->addli($aux,$tam1);		}else if($data["tipo"]=="checkbox"){			$this->MultiCell(200, 5,"".$data['pregunta']."\n", 0, 'J', 1, 0, $span, $aux, true);				//$campoval=array_filter(explode('<div class="respuestas" >',$data['campos']));			$campovalres=array_filter(explode('<div class="respuestas" >',$data['respuestas']));			$cont=1;			$acumuladorcampos="";			foreach ($campovalres as $campo) {				$campo=str_replace("</div>", "", $campo);				$campovalres[$cont]=str_replace("</div>", "", $campovalres[$cont]);				$acumuladorcampos.=$campovalres[$cont].", ";				$cont++;			}			$this->MultiCell(200, 10,$acumuladorcampos, 0, 'L', 1, 0, $span, $aux, true);				$aux=$this->addli($aux,$tam1);            $cont++;	          	if(strlen($acumuladorcampos)>=90){				   $aux=$this->addli($aux,$tam1);				   //$this->MultiCell(90, 10,$aux, 0, 'J', 1, 0, $span, $aux, true);				}		} 		    						}				}		function addli($li,$aumento,$head=0){			if($li>300){				$this->addpage();				$li=35;			}						$li=$li+$aumento;			return $li;		}	  function cabecera($datos,$pos, $codigofact){				         $this->SetFillColor(255, 255, 255);		 $image_file = "cabecera1.jpg";                      $this->Image($image_file,5, $pos, 75, '', 'JPG', '', 'T', false, 100, '', false, false, 0, false, false, false);    	$this->SetFont('helvetica', 'B', 7);				   $texto1=$this->remplazarcaracteres(" Licencia de Salud Ocupacional Reseolucion No. 0668 07/03/2007 \nCodigo de prestador de servicio de salud No 700010120303\nMinproteccionsocial Resol. No 0197 del 18 de febrero de 2010\nVigilidado Supersalud ");			$this->MultiCell(120, 20,$texto1, 0, 'C', 1, 0, 105, $pos, true);			$pos=$pos+14;    					 $image_file = "../fotos/pacientes/".$datos[0]['foto'];                      $this->Image($image_file,170, $pos+25, 30, '', 'JPG', '', 'T', false, 100, '', false, false, 0, false, false, false);		$this->MultiCell(120, 5,"Historia:".$codigofact, 0, 'C', 1, 0,125, $pos, true);        	$this->SetFont('helvetica', '', 9);		            $texto1=$this->remplazarcaracteres(" Carrera 27 No 12-115 : Tel 2740472 : Cels 311 6630503 - 301 4447013 SINCELEJO, COL.");			$this->MultiCell(200, 5,$texto1, 0, 'C', 1, 0, 5, $pos, true,0,true);          		  $this->SetFont('helvetica', 'B', 12);           $pos=$pos+6;            $texto1=$this->remplazarcaracteres(" CERTIFICADO INTEGRAL DE APTITUD MEDICA OCUPACIONAL");			$this->MultiCell(200, 5,$texto1, 0, 'C', 1, 0, 5, $pos, true,0,true);$pos=$pos+5;            $texto1=$this->remplazarcaracteres(" HISTORIA CLINICA OCUPACIONAL");			$this->MultiCell(200, 5,$texto1, 0, 'C', 1, 0, 5, $pos, true,0,true);		//$this->MultiCell(120, 5,$this->codigofact, 0, 'C', 1, 0,50, 319, true);		}	//Page header	public function Header() {	} function lineasVerticales(){}	function remplazarcaracteres($caracter){		return $caracter;		$caracter=str_replace("á","Á",$caracter);		$caracter=str_replace("é","É",$caracter);		$caracter=str_replace("í","Í",$caracter);		$caracter=str_replace("ó","Ó",$caracter);		$caracter=str_replace("ú","Ú",$caracter);		$caracter=str_replace("ñ","Ñ",$caracter);		return $caracter;	}function tabladedatos(			$datosbd,			$datosaptitud,			$datosdbrecomendaciones,			$codhistoriaotros,			$otrosexamenes,			$codigofact){	$epg="";					$this->addpage();				$this->certificadointegral($datosbd,$datosaptitud,$datosdbrecomendaciones, $codigofact);				if($codhistoriaotros!=""){					$this->addpage();					$this->otrosexamenesimp($otrosexamenes,10);							}							 	}//Pie de página	// Page footer	public function Footer() {		//Piecera		/*		$this->SetFont('helvetica', '', 10);		$this->SetFillColor(255, 255, 255);		$this->RoundedRect(4, 239, 150, 20, 3.50, '1111');		$this->MultiCell(55, 5,"Observaciones", 0, 'L', 1, 100, 10, 240, true);		$this->MultiCell(55, 5,"Escala de Desempeño", 0, 'L', 1, 100, 100, 240, true);		// Position at 15 mm from bottom		$this->SetY(-15);		// Set font		$this->SetFont('helvetica', 'I', 8);*/		// Page number		$this->SetY(-15);		$this->SetFont('helvetica', 'I', 8);	$this->Cell(0, 10,"Pag. ".$this->PageNo()."", 0,0,'C');	}}// create new PDF document$pdf = new MYPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, "A4", true, 'UTF-8', false);// set document information$pdf->SetCreator(PDF_CREATOR);$pdf->setLanguageArray($l);// set default header data$pdf->SetHeaderData(PDF_HEADER_LOGO, PDF_HEADER_LOGO_WIDTH, PDF_HEADER_TITLE, PDF_HEADER_STRING);// set header and footer fonts$pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));$pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));// set default monospaced font$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);//set margins$pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);$pdf->SetHeaderMargin(PDF_MARGIN_HEADER);$pdf->SetFooterMargin(PDF_MARGIN_FOOTER);//set auto page breaks$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);//set image scale factor$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);//set some language-dependent strings$pdf->setLanguageArray($l);// ---------------------------------------------------------// set font$pdf->SetFont('times', 'BI', 12);	$consulta = "SELECT  					tipoex.nombre as tipo,					ord.fecha as fecha, 					emp.razonsocial, 					h.enmision as enmision,					pac.nombres,					pac.apellidos,					pac.identificacion,					CASE					WHEN (MONTH(pac.fechanacimiento) < MONTH(current_date)) THEN YEAR(current_date) - YEAR(pac.fechanacimiento)					WHEN (MONTH(pac.fechanacimiento) = MONTH(current_date)) AND (DAY(pac.fechanacimiento) <= DAY(current_date)) THEN YEAR(current_date) - YEAR(pac.fechanacimiento)					ELSE (YEAR(current_date) - YEAR(pac.fechanacimiento)) - 1					END AS edad,					cargo.cargo_atual,					act.nombre as examen,					pac.foto as foto,					pac.firma as firma,					ord.codigo as codorden				from 					orden_actividades ord,					detalle_orden_actividades detord,					actividades act,					historias h,					historias_tipo_examenes tipo,					tipo_examenes tipoex,					historias_paciente hp,					pacientes pac,					actividaescontratadas contrato,					empresas emp,					historias_informacion_ocupacional cargo				where 					ord.codigo = detord.codorden_actividad and					detord.codactividad  = act.codigo and					h.codorden=ord.codigo and					h.paciente=pac.codigo and					h.codigo=hp.codhistoria and					tipo.codhistoria=h.codigo and 					tipoex.codigo=tipo.codexamen and					ord.codcontrato=contrato.codigo and 					emp.codigo=contrato.codempresa and					h.codigo=cargo.codhistoria and					h.codigo=$codigofact";//echo $consulta;$result = $bd->ejecutar($consulta);$datosdb="";$datosdbactitud="";$datosdbrecomendaciones="";$codorden="";while($fila= $bd->obtener_fila($result,0)){$codorden=$fila['codorden'];$datosdb[]=array(                'tipo'          =>$fila['tipo'],                                'fecha'             =>$fila['fecha'],                                'razonsocial'           =>$fila['razonsocial'],                                'enmision'           =>$fila['enmision'],                                'nombres'              =>$fila['nombres'],                                'apellidos'            =>$fila['apellidos'],                                'identificacion'         =>$fila['identificacion'],                                'edad'                =>$fila['edad'],                                'cargo_atual'                 =>$fila['cargo_atual'],                                'examen'                     =>$fila['examen'],								'foto'                     =>$fila['foto'],								'firma'                     =>$fila['firma'],                                     			 );} //while//Buscar concepto de aptitud$consultaref = "			select c.nombre as nombreconceptofrom historias h,historias_concepto_actitud_medica_ocupcional hc,concepto_actitud_medica_ocupcional cwhereh.codigo=hc.codhistoria andc.codigo=hc.codconcepto andh.codigo=".$codigofact."";$resultref = $bd->ejecutar($consultaref);$datosdbactitud="";while ($filaref= $bd->obtener_fila($resultref,0)){	$datosdbactitud[]=array('nombreconcepto'=>$filaref['nombreconcepto']);}$consultaref = "SELECT 						re.nombre as rgeneral, 					codrecomendaciones_laborales as codigo, 					c.nombre as recomendacion				from 					historias h,					historias_recomendaciones_laborales hc,					detallesderecomendaciones_laborales c,					recomendaciones_laborales re				where					re.codigo=c.codrecomendaciones_laborales and					h.codigo=hc.codhistoria and					c.codigo=hc.codrecomendacion and					h.codigo=".$codigofact." order  by codrecomendaciones_laborales";$resultref = $bd->ejecutar($consultaref);$datosdbrecomendaciones="";while ($filaref= $bd->obtener_fila($resultref,0)){	$datosdbrecomendaciones[]=array(						'recomendacion'=>$filaref['recomendacion'],						'codigo'=>$filaref['codigo'],						'rgeneral'=>$filaref['rgeneral']							);}$consultaref = "SELECT 						re.nombre as rgeneral, 					codrecomendaciones_laborales as codigo, 					c.nombre as recomendacion				from 					historias h,					historias_recomendaciones_laborales hc,					detallesderecomendaciones_laborales c,					recomendaciones_laborales re				where					re.codigo=c.codrecomendaciones_laborales and					h.codigo=hc.codhistoria and					c.codigo=hc.codrecomendacion and					h.codigo=".$codigofact." order  by codrecomendaciones_laborales";$resultref = $bd->ejecutar($consultaref);$datosdbrecomendaciones="";while ($filaref= $bd->obtener_fila($resultref,0)){	$datosdbrecomendaciones[]=array(						'recomendacion'=>$filaref['recomendacion'],						'codigo'=>$filaref['codigo'],						'rgeneral'=>$filaref['rgeneral']							);}##############################################################################################################################//Otros examenes##############################################################################################################################$consultaref = "SELECT 					codigo				from 					historias_otros				where					codorden=(						SELECT 							codigo						from 							orden_actividades						where 							codigo=(								SELECT 									codorden 									from 									historias									where 									codigo='$codigofact'								)						)				";//echo $consultaref;$resultref = $bd->ejecutar($consultaref);$otrosexamenes="";$arrexamenes="";$codhistoriaotros="";while ($filaref= $bd->obtener_fila($resultref,0)){$codhistoriaotros[]=$filaref;$sqlotrosexamenes = "SELECT 				h.codigo as codhistoriaotros,                hd.respuestas,                hd.observacion resobservacion,                 ah.codigo as codpregunta,                ah.pregunta,                ah.tipo,                ah.campos,                ah.valorpordefecto,                ah.observacion preobservacion,                ah.codigo as codpregunta,                ap.codigo as codpadre,                ap.nombre as nompadre,                a.nombre as nomactividad              from                 historias_otros h,                historias_otros_detalles hd,                actividades_preguntas ah,                actividades_nomformularios ap,                actividadesdelaempresa ade,                actividades a              where                hd.codhistoriaotros=h.codigo and                hd.codpregunta=ah.codigo and                ah.codnombreformulario=ap.codigo and                ade.codigo=ap.codactdelaempresa and                 ade.codactividad=a.codigo and                ap.certificado='ok' and                h.codigo ='".$filaref['codigo']."'	  	             ORDER BY ap.orden,ap.codigo,ah.codigo, ah.orden					";		$rstotrosexamenes = $bd->ejecutar($sqlotrosexamenes);	//echo $sqlotrosexamenes;	while ($filaotros= $bd->obtener_fila($rstotrosexamenes,0)){		$otrosexamenes[]=$filaotros;	}}//var_dump($codhistoriaotros);if($datosdb!=""){	$pdf->tabladedatos(				$datosdb,				$datosdbactitud,				$datosdbrecomendaciones,				$codhistoriaotros,				$otrosexamenes,				$codigofact);}else{	echo "No hay datos para esta historia $codigofact";	exit;}// set some text to print// print a block of text using Write()$pdf->Write($h=0, "", $link='', $fill=0, $align='C', $ln=true, $stretch=0, $firstline=false, $firstblock=false, $maxh=0);// ---------------------------------------------------------//Close and output PDF document$pdf->Output('formatos.pdf', 'I');//============================================================+// END OF FILE//============================================================+?>