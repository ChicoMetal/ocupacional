<?php//============================================================+// File name   : example_003.php// Begin       : 2008-03-04// Last Update : 2010-08-08//// Description : Example 003 for TCPDF class//               Custom Header and Footer//// Author: Nicola Asuni//// (c) Copyright://               Nicola Asuni//               Tecnick.com LTD//               Manor Coach House, Church Hill//               Aldershot, Hants, GU12 4RQ//               UK//               www.tecnick.com//               info@tecnick.com//============================================================+/** * Creates an example PDF TEST document using TCPDF * @package com.tecnick.tcpdf * @abstract TCPDF - Example: Custom Header and Footer * @author Nicola Asuni * @since 2008-03-04 */require_once('tcpdf/config/lang/eng.php');require_once('tcpdf/tcpdf.php');require 'clases/Db.class.php';require 'clases/Conf.class.php';require 'clases/Conv.class.php';$bd=Db::getInstance();$conv=Conv::getInstance();$codigo=$_GET['codigo'];// Extend the TCPDF class to create custom Header and Footerclass MYPDF extends TCPDF {	public  $filaactual=0;	public $compasig="",$compacate="";	private  $codigofact="",$entroli=0;		 function certificadointegral($datos,$codigo){		$style6 = array('width' => 0.1, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0, 'color' => array(0, 0, 0));		$tam1=5;		$li=35;		$this->cabecera($datos,4, $codigo);		$this->SetFont('helvetica', '', 10);		$this->SetFillColor(255, 255, 255);		$li=$li+$tam1;				$this->MultiCell(200, 5,"Fecha:".strtoupper($datos[0]['fecha']). "       Empresa: ".strtoupper($datos[0]['nompro'])."\n", 0, 'J', 1, 0, 5, $li, true);		$li=$li+$tam1;		/*$this->MultiCell(200, 5,"Dirección:".strtoupper($datos[0]['dirpro']). "       Telefono: ".strtoupper($datos[0]['telefonopro'])."\n", 0, 'J', 1, 0, 5, $li, true);		$li=$li+$tam1;		$this->MultiCell(200, 5,"Celular:".strtoupper($datos[0]['celularpro']). "       Contacto: ".strtoupper($datos[0]['contactopro'])."\n", 0, 'J', 1, 0, 5, $li, true);		$li=$li+$tam1;*/		$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);		$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6);		$this->MultiCell(200, 5,"Paciente: ".strtoupper($datos[0]['nombres'])." ".strtoupper($datos[0]['apellidos'])." Cedula: ".strtoupper($datos[0]['identificacion'])."\n", 0, 'J', 1, 0, 5, $li, true);		$li=$li+$tam1;		$this->RoundedRect(4, $li, 200,$tam1 , 3.50, '0000',null,$style6); 	 	$this->buscaraudiometria($datos,$li);	 }	function buscaraudiometria($datos,$inicio){$style6 = array('width' => 0.1, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0, 'color' => array(0, 0, 0));		$tam1=4;       $li=$inicio;	  	  // $this->SetFont('helvetica', 'B', 10);//$li=$li+$tam1;	 //$this->MultiCell(200, 5,"RECOMENDACIONES LABORALES\n", 0, 'C', 1, 0, 5, $li, true);	 $li=$li+$tam1+8;	 $texto="Autorizo a los profesionales de <b>SALUD OCUPACIONAL INTEGRAL EMPRESARIAL LIMITADA</b> para que me realicen de manera voluntaria los exámenes médicos ocupacionales, exámenes complementarios solicitados por la empresa según el cargo al cual aspiro u ocupo y dejo constancia que tuve la oportunidad de manifestar mi consentimiento para la realización de los exámenes médicos y/o complementarios necesarios y referenciados en este documento.<br><br>			Certifico que la información que suministre en la realización de los exámenes es verdadera completa y no omití ningún dato relevante de mi estado de salud. Fui informado y dejo constancia que soy consciente de las implicaciones legales y laborales que pueda tener mi estado de salud con relación al concepto integral de aptitud ocupacional que emita el médico de acuerdo a lo  solicitado por la empresa, igualmente soy consciente y acepto el concepto favorable o desfavorable que se emita con relación al cargo que aspiro u ocupo por el estado de salud que tengo al momento del examen. <br><br>			Acepto el manejo de confidencialidad que <b>SALUD OCUPACIONAL INTEGRAL EMPRESARIAL LTDA</b> le dé a mi historia clínica y autorizo que de la información necesaria de mi historia clínica a la empresa contratante o entidades contempladas en la legislación vigente para el cumplimiento y desarrollo del programa de salud ocupacional.<br><br>			Certifico que he sido informado(a) de los exámenes que la empresa contratante solicita, de la naturaleza y propósito de los exámenes y complementarios y de los riesgos que implican su intervención, autorizo a <b>SALUD OCUPACIONAL INTEGRAL EMPRESARIAL LTDA </b>a practicarme los exámenes médicos ocupacionales y complementarios  indicados a continuación:<br><br>			";		$this->MultiCell(200, 5,$texto, 0, 'J', 1, 0, 5, $li, true,0,true);	 $li=$li+$tam1+80;	 $this->SetFont('helvetica', '', 10);	 $i=0;	 	 $tamori= $li;	 $aux=$li;	 $enx=5;	 $entro=0;	 $cambiodelinea=0;	 $mayoraux=0;	 		//var_dump($datos);	foreach($datos as $act) {		$li=$li+4;		$this->MultiCell(200, 5,$act['anombre'], 0, 'L', 1, 0, 5, $li, true);	 	}	$li=$li+14;	$texto="Certifico que me explicaron detalladamente los resultados de los exámenes realizados y que estuve de acuerdo con sus interpretaciones, Me entregaron copia de los exámenes realizados.";	$this->MultiCell(200, 5,$texto, 0, 'J', 1, 0, 5, $li, true,0,true);	$li=$li+24;				 $this->SetFont('helvetica', '', 10);		 $this->Line( 5,$li ,100,$li);	$this->MultiCell(80, 5,"<B>Firma del paciente y CC </B>"."\n", 0, 'C', 1, 0, 5, $li, true,0,true);			$this->RoundedRect(150, $li-10, 25, 30,2, '1111');	$li=$li+20;	$this->MultiCell(80, 5,"<B>Huella</B>"."\n", 0, 'L', 1, 0, 155, $li, true,0,true);					}	  function cabecera($datos,$pos, $codigofact){		$this->SetFillColor(255, 255, 255);		$image_file = "cabecera1.jpg";		$this->Image($image_file,5, $pos, 75, '', 'JPG', '', 'T', false, 100, '', false, false, 0, false, false, false);		$this->SetFont('helvetica', 'B', 7);		$texto1=$this->remplazarcaracteres(" Licencia de Salud Ocupacional Reseolucion No. 0668 07/03/2007 \nCodigo de prestador de servicio de salud No 700010120303\nMinproteccionsocial Resol. No 0197 del 18 de febrero de 2010\n ");		$this->MultiCell(120, 20,$texto1, 0, 'C', 1, 0, 105, $pos, true);		$pos=$pos+14;		$this->MultiCell(120, 5,"Codigo:".$codigofact, 0, 'C', 1, 0,125, $pos, true);		$this->SetFont('helvetica', '', 9);		$texto1=$this->remplazarcaracteres(" Carrera 27 No 12-115 : Tel 2740472 : Cels 311 6630503 - 301 4447013 SINCELEJO, COL.");		$this->MultiCell(200, 5,$texto1, 0, 'C', 1, 0, 5, $pos, true,0,true);		$this->SetFont('helvetica', 'B', 12);		$pos=$pos+6;		$texto1=$this->remplazarcaracteres("CONSENTIMIENTO DE INFORMADO PARA REALIZAR EXÁMENES MÉDICOS OCUPACIONALES");		$this->MultiCell(200, 5,$texto1, 0, 'C', 1, 0, 5, $pos, true,0,true);				//$this->MultiCell(120, 5,$this->codigofact, 0, 'C', 1, 0,50, 319, true);	}	//Page header	public function Header() {	} function lineasVerticales(){}	function remplazarcaracteres($caracter){		return $caracter;		$caracter=str_replace("á","Á",$caracter);		$caracter=str_replace("é","É",$caracter);		$caracter=str_replace("í","Í",$caracter);		$caracter=str_replace("ó","Ó",$caracter);		$caracter=str_replace("ú","Ú",$caracter);		$caracter=str_replace("ñ","Ñ",$caracter);		return $caracter;	}	function tabladedatos($datosbd,$codigo){		$epg="";					$this->addpage();					$this->certificadointegral($datosbd,$codigo);	}//Pie de página	// Page footer	public function Footer() {		//Piecera		/*		$this->SetFont('helvetica', '', 10);		$this->SetFillColor(255, 255, 255);		$this->RoundedRect(4, 239, 150, 20, 3.50, '1111');		$this->MultiCell(55, 5,"Observaciones", 0, 'L', 1, 100, 10, 240, true);		$this->MultiCell(55, 5,"Escala de Desempeño", 0, 'L', 1, 100, 100, 240, true);		// Position at 15 mm from bottom		$this->SetY(-15);		// Set font		$this->SetFont('helvetica', 'I', 8);*/		// Page number		$this->SetY(-15);		$this->SetFont('helvetica', 'I', 8);	$this->Cell(0, 10,"Pag. ".$this->PageNo()."", 0,0,'C');	}}// create new PDF document$pdf = new MYPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, "A4_LONG", true, 'UTF-8', false);// set document information$pdf->SetCreator(PDF_CREATOR);$pdf->setLanguageArray($l);// set default header data$pdf->SetHeaderData(PDF_HEADER_LOGO, PDF_HEADER_LOGO_WIDTH, PDF_HEADER_TITLE, PDF_HEADER_STRING);// set header and footer fonts$pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));$pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));// set default monospaced font$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);//set margins$pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);$pdf->SetHeaderMargin(PDF_MARGIN_HEADER);$pdf->SetFooterMargin(PDF_MARGIN_FOOTER);//set auto page breaks$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);//set image scale factor$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);//set some language-dependent strings$pdf->setLanguageArray($l);// ---------------------------------------------------------// set font$pdf->SetFont('times', 'BI', 12);$consulta = "SELECT 				p.nombres,				p.apellidos,				p.identificacion,				p.foto,                det.codactividad,                a.nombre as anombre ,                a.descripcion,                o.fecha,                det.codigo as codetalle,                o.codigo as codorden,                e.razonsocial as nompro,                e.direccion as dirpro,                e.telefono as telefonopro              from                 orden_actividades o,                detalle_orden_actividades det,                actividades a ,                pacientes p,                empresas e,                actividaescontratadas c              where                 o.codigo=det.codorden_actividad and                 det.codactividad=a.codigo and                o.codpaciente=p.codigo and                o.codcontrato=c.codigo and                e.codigo=c.codempresa and                o.codigo='$codigo' ";//echo $consulta ;$result = $bd->ejecutar($consulta);while($fila= $bd->obtener_fila($result,0)){$datosdb[]=$fila;} //while//Buscar preguntas audiometriasif($datosdb!=""){	$pdf->tabladedatos($datosdb,$codigo);}else{	echo "No hay datos para esta historia $codigofact";	exit;}// set some text to print// print a block of text using Write()$pdf->Write($h=0, "", $link='', $fill=0, $align='C', $ln=true, $stretch=0, $firstline=false, $firstblock=false, $maxh=0);// ---------------------------------------------------------//Close and output PDF document$pdf->Output('formatos.pdf', 'I');//============================================================+// END OF FILE//============================================================+?>