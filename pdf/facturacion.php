<?php//============================================================+// File name   : example_003.php// Begin       : 2008-03-04// Last Update : 2010-08-08//// Description : Example 003 for TCPDF class//               Custom Header and Footer//// Author: Nicola Asuni//// (c) Copyright://               Nicola Asuni//               Tecnick.com LTD//               Manor Coach House, Church Hill//               Aldershot, Hants, GU12 4RQ//               UK//               www.tecnick.com//               info@tecnick.com//============================================================+/** * Creates an example PDF TEST document using TCPDF * @package com.tecnick.tcpdf * @abstract TCPDF - Example: Custom Header and Footer * @author Nicola Asuni * @since 2008-03-04 */require_once('tcpdf/config/lang/eng.php');require_once('tcpdf/tcpdf.php');require 'clases/Db.class.php';require 'clases/Conf.class.php';require 'clases/Conv.class.php';$bd=Db::getInstance();$conv=Conv::getInstance();$codfactura=$_GET['codigo'];// Extend the TCPDF class to create custom Header and Footerclass MYPDF extends TCPDF {	public  $filaactual=0;	public $compasig="",$compacate="";	private  $codigofact="",$entroli=0;		 function facturacion($datos, $codigofact){	 	$this->SetFont('helvetica', '', 8);		$this->SetFillColor(255, 255, 255);		$sinpuentear = array('width' => 0.1, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0, 'color' => array(0, 0, 0));		$punteado = array('width' => 0.1, 'cap' => 'butt', 'join' => 'miter', 'dash' => '3,1', 'color' => array(0, 0, 0));							$style6 = array('width' => 0.1, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0, 'color' => array(0, 0, 0)); 			$tam1=5;		$li=34;		$this->cabecera($datos,4, $codigofact);		$this->SetFont('helvetica', '', 10);		$this->SetFillColor(255, 255, 255);		$li=$this->addli($li,8);				$primero="";		$codpaciente="";		$subtotal=0;		$li=$this->addli($li,4);		$grantotal=0;			foreach($datos as $data){			if($codpaciente!=$data['codpaciente']){				if($primero!=0){					$this->SetFont('helvetica', 'B', 10);					$li=$this->addli($li,4);						$this->MultiCell(200, 5,"Subtotal: ", 0, 'L', 1, 0, 122, $li, true);					$this->MultiCell(200, 5,$subtotal, 0, 'L', 1, 0, 180, $li, true);					$li=$this->addli($li,4);							$this->Line(5, $li, 205,$li,$sinpuentear);										}else{					$primero=1;				}				$this->SetFont('helvetica', '', 10);				$subtotal=0;				$this->Line(5, $li, 205,$li,$sinpuentear);				$this->MultiCell(200, 5,$data['identificacion'], 0, 'L', 1, 0, 12, $li, true);				$this->MultiCell(200, 5,$data['nombres']." ".$data['apellidos'], 0, 'L', 1, 0, 46, $li, true);				$this->MultiCell(200, 5,$data['fecha'], 0, 'L', 1, 0, 122, $li, true);				$li=$this->addli($li,4);					$this->Line(5, $li, 205,$li,$sinpuentear);						$this->MultiCell(50, 5,$data['nomexamen'], 0, 'L', 1, 0, 122, $li, true);								$this->MultiCell(200, 5,$data['valor'], 0, 'L', 1, 0, 180, $li, true);								$subtotal=$subtotal+$data['valor'];				$grantotal=$grantotal+$data['valor'];				$li=$this->addli($li,4);				if(strlen($data['nomexamen'])>=24){					$li=$this->addli($li,4);					if(strlen($data['nomexamen'])>=34){						$li=$this->addli($li,4);											if(strlen($data['nomexamen'])>=60){							$li=$this->addli($li,8);							if(strlen($data['nomexamen'])>=94){								$li=$this->addli($li,4);								if(strlen($data['nomexamen'])>=128){									$li=$this->addli($li,4);													}												}											}																		}				}				}else{								$this->MultiCell(50, 5,$data['nomexamen'], 0, 'L', 1, 0, 122, $li, true);								$this->MultiCell(200, 5,$data['valor'], 0, 'L', 1, 0, 180, $li, true);								$subtotal=$subtotal+$data['valor'];				$grantotal=$grantotal+$data['valor'];				$li=$this->addli($li,4);				if(strlen($data['nomexamen'])>=24){					$li=$this->addli($li,4);					if(strlen($data['nomexamen'])>=34){						$li=$this->addli($li,4);											if(strlen($data['nomexamen'])>=60){							$li=$this->addli($li,4);							if(strlen($data['nomexamen'])>=94){								$li=$this->addli($li,4);								if(strlen($data['nomexamen'])>=128){									$li=$this->addli($li,4);													}												}											}																		}				}			}//fin codpaciente			$codpaciente=$data['codpaciente'];		}//fin foreach		$this->SetFont('helvetica', 'B', 10);		$this->MultiCell(200, 5,"Subtotal: ", 0, 'L', 1, 0, 122, $li, true);		$this->MultiCell(200, 5,$subtotal, 0, 'L', 1, 0, 180, $li, true);		$li=$this->addli($li,4);				$this->Line(5, $li, 205,$li,$sinpuentear);			$li=$this->addli($li,1);		$this->Line(5, $li, 205,$li,$sinpuentear);			$li=$this->addli($li,1);		$this->Line(5, $li, 205,$li,$sinpuentear);			$li=$this->addli($li,1);		$this->SetFont('helvetica', 'B', 10);		$this->MultiCell(200, 5,"Total: ", 0, 'L', 1, 0, 122, $li, true);		$this->MultiCell(200, 5,$grantotal, 0, 'L', 1, 0, 180, $li, true);								 }			function addli($li,$aumento,$head=0){			if($li>240){				$this->addpage();				$li=35;			}						$li=$li+$aumento;			return $li;		}	  function cabecera($datos,$pos, $codigofact){		$this->SetFillColor(255, 255, 255);		$image_file = "cabecera1.jpg";		$this->Image($image_file,5, $pos, 75, '', 'JPG', '', 'T', false, 100, '', false, false, 0, false, false, false);		$this->SetFont('helvetica', 'B', 7);		$texto1=$this->remplazarcaracteres(" Licencia de Salud Ocupacional Reseolucion No. 0668 07/03/2007 \nCodigo de prestador de servicio de salud No 700010120303\nMinproteccionsocial Resol. No 0197 del 18 de febrero de 2010\nVigilidado Supersalud ");		$this->MultiCell(120, 20,$texto1, 0, 'C', 1, 0, 105, $pos, true);		$pos=$pos+14;		$this->MultiCell(120, 5,"Anexo de Factura n°:".$codigofact, 0, 'C', 1, 0,125, $pos, true);		$this->SetFont('helvetica', '', 9);		$texto1=$this->remplazarcaracteres(" Carrera 27 No 12-115 : Tel 2740472 : Cels 311 6630503 - 301 4447013 SINCELEJO, COL.");		$this->MultiCell(200, 5,$texto1, 0, 'C', 1, 0, 5, $pos, true,0,true);		$this->SetFont('helvetica', 'B', 12);		$pos=$pos+6;		$this->MultiCell(200, 5,$texto1, 0, 'C', 1, 0, 5, $pos, true,0,true);		//$this->RoundedRect(4, 32, 201, 14, 3.50, '1111',"F","",array(0, 150, 0));		//		$this->MultiCell(200, 20,"Empresa: ".$datos[0]['razonsocial']." Nit: ".$datos[0]['nit'], 0, 'L', 1, 0, 12,32, true);						//Cabecera verde		$this->SetFont('helvetica', 'B', 9);		$this->MultiCell(150, 20,"Identificación", 0, 'L', 1, 0, 12,40, true);		$this->SetFont('helvetica', 'B', 8);		$this->MultiCell(150, 20,"Nombres y apellidos", 0, 'L', 1, 0, 46,40, true);		$this->SetFont('helvetica', 'B', 9);				$this->MultiCell(150, 20,"Fecha/Examenes", 0, 'L', 1, 0, 122,40, true);		$this->MultiCell(20, 10,"Valor", 0, 'C', 1, 0, 180,40, true);			}	//Page header	public function Header() {	} function lineasVerticales(){}	function remplazarcaracteres($caracter){		return $caracter;		$caracter=str_replace("á","Á",$caracter);		$caracter=str_replace("é","É",$caracter);		$caracter=str_replace("í","Í",$caracter);		$caracter=str_replace("ó","Ó",$caracter);		$caracter=str_replace("ú","Ú",$caracter);		$caracter=str_replace("ñ","Ñ",$caracter);		return $caracter;	}function tabladedatos(			$datosbd,			$codigofact){	$epg="";	$this->addpage();	$this->facturacion($datosbd, $codigofact);						 	}//Pie de página	// Page footer	public function Footer() {		//Piecera		/*		$this->SetFont('helvetica', '', 10);		$this->SetFillColor(255, 255, 255);		$this->RoundedRect(4, 239, 150, 20, 3.50, '1111');		$this->MultiCell(55, 5,"Observaciones", 0, 'L', 1, 100, 10, 240, true);		$this->MultiCell(55, 5,"Escala de Desempeño", 0, 'L', 1, 100, 100, 240, true);		// Position at 15 mm from bottom		$this->SetY(-15);		// Set font		$this->SetFont('helvetica', 'I', 8);*/		// Page number		$this->SetY(-15);		$this->SetFont('helvetica', 'I', 8);	$this->Cell(0, 10,"Pag. ".$this->PageNo()."", 0,0,'C');	}}// create new PDF document$pdf = new MYPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, "A4", true, 'UTF-8', false);// set document information$pdf->SetCreator(PDF_CREATOR);$pdf->setLanguageArray($l);// set default header data$pdf->SetHeaderData(PDF_HEADER_LOGO, PDF_HEADER_LOGO_WIDTH, PDF_HEADER_TITLE, PDF_HEADER_STRING);// set header and footer fonts$pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));$pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));// set default monospaced font$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);//set margins$pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);$pdf->SetHeaderMargin(PDF_MARGIN_HEADER);$pdf->SetFooterMargin(PDF_MARGIN_FOOTER);//set auto page breaks$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);//set image scale factor$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);//set some language-dependent strings$pdf->setLanguageArray($l);// ---------------------------------------------------------//Valores de los contratos/*$sqlval="SELECT	    deta.codactividad,    deta.valorFROM  detalleactividaescontratadas deta,  actividaescontratadas aWHERE deta.codcontrato=a.codigo and a.codempresa= (select codempresa from facturas where codigo='$codfactura'); ";//echo $sqlval;$resultval = $bd->ejecutar($sqlval);$codempresa="";$arrvalores="";while($fila= $bd->obtener_fila($resultval,0)){	$arrvalores[]=$fila;	} //while*/// set font$pdf->SetFont('times', 'BI', 12);$consulta = 	"SELECT        f.codigo,		p.codigo as codpaciente,		p.identificacion,		p.nombres, 		p.apellidos,		e.razonsocial,		e.nit,		o.fecha,		a.nombre as nomexamen,		o.codigo as codorden,		a.codigo as codactividad,		fd.codactividad ,		fd.valor	FROM		orden_actividades o,		detalle_orden_actividades deto,		actividades a,		pacientes p,		actividaescontratadas ac,		empresas e,		facturas f,		facturas_detalles fd	WHERE 		o.codigo=deto.codorden_actividad and 		o.codcontrato=ac.codigo and		deto.codactividad=a.codigo and		p.codigo=o.codpaciente and 		ac.codempresa=e.codigo and		fd.codorden=o.codigo and		fd.codfactura=f.codigo and    	f.codempresa=e.codigo and    	fd.codactividad=a.codigo and		f.codigo='$codfactura'		ORDER BY p.codigo, o.fecha";//echo $consulta;$result = $bd->ejecutar($consulta);$datosdb="";$datosdbactitud="";$datosdbrecomendaciones="";$codorden="";$i=0;while($fila= $bd->obtener_fila($result,0)){	$datosdb[]=$fila;  $i++;} //while//Buscar concepto de aptitudif($datosdb!=""){	$pdf->tabladedatos(				$datosdb,				$codfactura);}else{	echo "No hay datos para esta factura $codfactura";	exit;}// set some text to print// print a block of text using Write()$pdf->Write($h=0, "", $link='', $fill=0, $align='C', $ln=true, $stretch=0, $firstline=false, $firstblock=false, $maxh=0);// ---------------------------------------------------------//Close and output PDF document$pdf->Output('formatos.pdf', 'I');//============================================================+// END OF FILE//============================================================+?>